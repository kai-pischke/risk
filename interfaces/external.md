
## Message.hs
```hs
Response = General Update | Invalid Error Player | GameWon Player 
```
```hs
Update = WaitingRoom [Player] | Setup SetupState | Play GameState
```
```hs
Question = NumDefenders
```
```hs
Error = InvalidMove
  | NotYourTurn
  | NotEnoughPlayers
  | NotInWaitingRoom
  | SetupComplete
  | NotInSetup
  | NotInPlay
  | NotRequestingDefenders
```

```hs
Request = Request Player RequestType
```
```hs
RequestType = StartGame
            | PlaceTroop Country
            | Attack Country Country Attackers
            | Reinforce [(Country, Int)]
            | Fortify Country Country Int
            | Invade Int
            | ChooseDefenders Defenders
            | EndAttack
            | SkipFortify
```

## Interface.hs

```hs
empty :: StdGen -> Game
```

```hs
receive :: Request -> Game -> (Response, Game)
```
total function. For any request, checks whether it is valid and returns an
appropriate response message along with the new Game with the correct changes made.

```hs
addPlayer :: Game -> (Player, Game)
```
Errors if we aren't in the waiting phase, or if the waiting room is full, or if
the given waiting room is invalid (i.e. there are repeats)

export

```hs
Response(..)
```

```hs
Request(..)
```

## Parse.hs
Note we are using `Data.ByteString.Lazy (ByteString)`.

```
type parseError = ByteString
```
`parseError` is a `ByteString` holding the JSON-encoded response to a parse error.

```
decodeRequest :: ByteString -> Either Request ParseError
```
Reads in a received `ByteString` and returns a `Left Request` or a `Right ParseError`.

```
encodeResponse ::  Response -> ByteString
```
encodes a `Response` to a `ByteString`.

## Server.hs

## JSON
The set of all *well formed* json requests is given by the language generated by **request**, and the set of all *well formed* responses is given by the language generated by **response** using the formal grammar given below (up to json equivalence).

<pre>
<b>request</b> := <b>startgame</b>
           | <b>place</b>
           | <b>attack</b>
           | <b>reinforce</b>
           | <b>fortify</b>
           | <b>invade</b>
           | <b>choosedefenders</b>
           | <b>endattack</b>
           | <b>skipfort</b>

<b>response</b>  := <b>waiting</b>
           | <b>setup</b>
           | <b>playing</b>
           | <b>error</b>

<b>startgame</b> := {"action": "StartGame",
              "sender": <b>player</b>}

<b>place</b>     := {"action": "PlaceTroop",
              "sender": <b>player</b>,
              "country": <b>country</b>}

<b>attack</b>    := {"action": "Attack",
              "sender": <b>player</b>,
              "attacking_country": <b>country</b>,
              "defending_country": <b>country</b>,
              "number_of_attackers": <b>int</b>}

<b>reinforce</b> := {"action": "Reinforce",
              "sender": <b>player</b>,
              "troops": { <b>empty</b> | <b>troopmap</b> }}

<b>fortify</b>   := {"action": "Fortify",
              "sender": <b>player</b>,
              "from_country": <b>country</b>,
              "to_country": <b>country</b>,
              "number_of_troops": <b>int</b>}

<b>invade</b>    := {"action": "Invade",
              "sender": <b>player</b>,
              "number_of_troops": <b>int</b>}

<b>choosedefenders</b>    := {"action": "ChooseDefenders",
              "sender": <b>player</b>,
              "number_of_defenders": <b>int</b>}

<b>endattack</b> := {"action": "EndAttack", "sender": <b>player</b>}

<b>skipfort</b>  := {"action": "SkipFortify", "sender": <b>player</b>}
<b>error</b>     := {"kind": "Error" ,"error": <b>errortext</b>, "player": <b>player</b>}

<b>errortext</b> := "InvalidMove" | "NotYourTurn" | "NotEnoughPlayers" | "NotInWaitingRoom" | "SetupComplete" | "NotInSetup" | "NotInPlay" | "NotRequestingDefenders"


<b>waiting</b>   := {"kind": "State", "state": "WaitingRoom", "players": [ <b>empty</b> | <b>players</b> ]}

<b>setup</b>     := {"kind": "State",
              "state": "Setup",
              "players": [ <b>players</b> ],
              "board": <b>board</b>}

<b>playing</b>   := {"kind": "State",
              "state": "Play",
              "players": [ <b>players</b> ],
              "board": <b>board</b>,
              "phase": <b>phase</b>}

<b>phase</b>     := {"kind": "Simple", "phase": <b>simple</b>} | <b>battleend</b> | <b>midbattle<b>

<b>simple</b>    := "Reinforce" | "Fortify" | "Attack"

<b>battleend</b> := {"kind": "BattleEnd",
              "attacking_country": <b>country</b>,
              "defending_country": <b>country</b>,
              "attackers_remaining": <b>int</b>}

<b>midbattle<b> := {"kind": "MidBattle",
              "attacking_country": <b>country</b>,
              "defending_country": <b>country</b>,
              "attackers": <b>int</b>}

<b>board</b>     := { <b>boardlist</b> }

<b>troopmap</b>  := <b>country</b>: <b>int</b> | <b>troopmap</b>, <b>country</b>: <b>int</b>

<b>boardlist</b> := <b>gamefield</b> | <b>boardlist</b>, <b>gamefield</b>

<b>gamefield</b> := <b>country</b>: {"owner": <b>owner</b>, "number_of_troops": <b>int</b>}

<b>owner</b>     := <b>player</b> | "Unowned"

<b>players</b>   := <b>player</b> | <b>players</b>, <b>player</b>

<b>empty</b>     := ''

<b>player</b>    := "Black" | "Blue" | "Green" | "Red" | "Yellow"

<b>country</b>   := "Afghanistan"
           | "Alaska"
           | "Alberta"
           | "Argentina"
           | "Brazil"
           | "Central America"
           | "China"
           | "Congo"
           | "East Africa"
           | "Eastern Australia"
           | "Eastern United States"
           | "Egypt"
           | "Great Britain"
           | "Greenland"
           | "Iceland"
           | "India"
           | "Indonesia"
           | "Irkutsk"
           | "Japan"
           | "Kamchatka"
           | "Madagascar"
           | "Middle East"
           | "Mongolia"
           | "New Guinea"
           | "North Africa"
           | "Northern Europe"
           | "Northwest Territory"
           | "Ontario"
           | "Peru"
           | "Quebec"
           | "Scandenavia"
           | "Siam"
           | "Siberia"
           | "South Africa"
           | "Southern Europe"
           | "Ukraine"
           | "Ural"
           | "Venezuela"
           | "Western Australia"
           | "Western Europe"
           | "Western United States"
           | "Yakutsk"
</pre>
